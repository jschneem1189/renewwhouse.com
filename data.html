<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=yes" />
  <title>ReNEWW</title>
  <script src="libraries/jquery-1.9.1.js"></script>
  <script src="libraries/raphael.js"></script>
  <script src="components/pie.js"></script>
  <script src="components/popup.js"></script>
  <script src="components/graph.js"></script>
  <script src="components/house-hover.js"></script>
  <script src="components/AnimatedButton.js"></script>
  <script src="libraries/Chart.min.js"></script>
  <script src="libraries/amcharts_stocks/amcharts.js" type="text/javascript"></script> 
  <script src="libraries/amcharts_stocks/serial.js" type="text/javascript"></script> 
  <script src="libraries/amcharts_stocks/amstock.js" type="text/javascript"></script>
  <link rel="stylesheet" href="libraries/amcharts_stocks/style.css" type="text/css">
  <link rel="shortcut icon" href="images/32x32 logo.ico">
  <link rel="stylesheet" type="text/css" media="screen" href="css/data.css" />
  <link rel="stylesheet" type="text/css" media="screen and (min-width:321px) and (max-width: 650px)" href="css/data650.css" />
  <link rel="stylesheet" type="text/css" media="screen and (max-width: 320px)" href="css/data320.css" />
  <script>
  $(function() {
    $(function(){
        var R1 = Raphael("dataButton", 80, 30);
        // var R2 = Raphael("tourButton", 80, 30);
        var R3 = Raphael("aboutButton", 80, 30);
        var R4 = Raphael("partnerButton", 90, 30);
        var dataButton = new AnimatedButton(R1, "DATA", 80, 30);
        // var tourButton = new AnimatedButton(R2, "TOUR", 80, 30);
        this.aboutButton = new AnimatedButton(R3, "ABOUT", 80, 30);
        this.partnerButton = new AnimatedButton(R4, "PARTNERS", 90, 30);
      }.bind(this));

    this.getData = function() {
      if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
      } else { // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status==200) {
          // console.debug(xmlhttp.responseText);
          var chartData = JSON.parse(xmlhttp.responseText);
          // this.refreshChart(responseObj.labels,responseObj.values,[0,0]);
          this.buildChart(chartData);
        }
      }.bind(this);
      var date = new Date();
      xmlhttp.open("GET","http://localhost/data/getEnergyData_stock.php",true);
      xmlhttp.send();
    }.bind(this);

    var pieData = [
      {
          value: 300,
          color:"#F7464A",
          highlight: "#FF5A5E",
          label: "Kitchen"
      },
      {
          value: 50,
          color: "#46BFBD",
          highlight: "#5AD3D1",
          label: "Laundry"
      },
      {
          value: 100,
          color: "#FDB45C",
          highlight: "#FFC870",
          label: "Bedroom"
      }
    ]
    var pieOptions = {
        //Boolean - Whether we should show a stroke on each segment
        segmentShowStroke : true,

        //String - The colour of each segment stroke
        segmentStrokeColor : "#fff",

        //Number - The width of each segment stroke
        segmentStrokeWidth : 2,

        //Number - The percentage of the chart that we cut out of the middle
        percentageInnerCutout : 0, // This is 0 for Pie charts

        //Number - Amount of animation steps
        animationSteps : 100,

        //String - Animation easing effect
        animationEasing : "easeOutBounce",

        //Boolean - Whether we animate the rotation of the Doughnut
        animateRotate : true,

        //Boolean - Whether we animate scaling the Doughnut from the centre
        animateScale : false,

        //String - A legend template
        legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>"

    }
    // var pie1 = document.getElementById("energyUsedPieChart").getContext("2d");
    // var myPieChart1 = new Chart(pie1).Pie(pieData,pieOptions);

    // var pie2 = document.getElementById("energyGainedPieChart").getContext("2d");
    // var myPieChart2 = new Chart(pie2).Pie(pieData,pieOptions);

    //AMCHARTS
    this.buildChart = function(data){
      // create chart
      var chart = new AmCharts.AmStockChart();
      chart.pathToImages = "libraries/amcharts_stocks/images/";

      // create data set
      var dataSet = new AmCharts.DataSet();
      dataSet.dataProvider = data;
      dataSet.fieldMappings = [{fromField:"val", toField:"value"},{fromField:"val2", toField:"value2"}];
      dataSet.categoryField = "date";
      dataSet.title = "Energy Consumed";

      chart.dataSets = [dataSet];
      var stockPanel = new AmCharts.StockPanel();
      chart.panels = [stockPanel];

      // change settings
      var panelsSettings = new AmCharts.PanelsSettings();
      panelsSettings.startDuration = 1;
      chart.panelsSettings = panelsSettings;

      // create graph
      var graph = new AmCharts.StockGraph();
      graph.valueField = "value";
      graph.type = "column";
      graph.fillAlphas = 1;
      graph.title = "Energy Usage (W)";
      graph.periodValue = "Sum";
      stockPanel.addStockGraph(graph);

      var graph2 = new AmCharts.StockGraph();
      graph2.valueField = "value2";
      graph2.fillAlphas = 0.5;
      graph2.title = "Energy Harvested (W)";
      graph2.lineThickness = 3;
      graph2.lineColor = "#00cc00";
      graph2.useDataSetColors = false;
      graph2.periodValue = "Sum";
      stockPanel.addStockGraph(graph2);

      // category axis settings
      var categoryAxesSettings = new AmCharts.CategoryAxesSettings();
      categoryAxesSettings.minPeriod = "DD";
      categoryAxesSettings.equalSpacing = true;
      categoryAxesSettings.dashLength = 5;
      categoryAxesSettings.groupToPeriods = ["DD", "WW", "MM", "YYYY"];
      chart.categoryAxesSettings = categoryAxesSettings;

      var valueAxesSettings = new AmCharts.ValueAxesSettings();
      valueAxesSettings .dashLength = 5;
      chart.valueAxesSettings  = valueAxesSettings;

      // add graph to the scrollbar
      var chartScrollbarSettings = new AmCharts.ChartScrollbarSettings();
      chartScrollbarSettings.graph = graph;
      chartScrollbarSettings.graphType = "line";
      chart.chartScrollbarSettings = chartScrollbarSettings;

      // add legend
      var legend = new AmCharts.StockLegend();
      stockPanel.stockLegend = legend;

      // add tooltips
      var chartCursorSettings = new AmCharts.ChartCursorSettings();
      chartCursorSettings.valueBalloonsEnabled = true;
      chart.chartCursorSettings = chartCursorSettings;

      // add period selector
      var periodSelector = new AmCharts.PeriodSelector();
      chart.periodSelector = periodSelector;
      periodSelector.periods = [
         {period:"DD", count:5, label:"5 days"},
         {period:"MM", count:1, label:"1 month"},
         {period:"YYYY", count:1, label:"1 year"},
         {period:"YTD", selected:true, label:"YTD"},
         {period:"MAX", label:"MAX"}
      ];

      // draw chart
      chart.write("stockChart");
    };

    this.getData();
    alert("test")
  });
  </script>
</head>
<body>
    <!-- <div id="graph"></div> -->
    <div id="content">
      <h1>OUR DATA</h1>
      <div id="energySection" class="section odd">
        <img class="cutout" src="images/white-blue_cutout.jpg"/>
        <img class="icon" src="images/blue_lightbulb.jpg"/>
        <div id="stockChart"></div>
        <!-- <ul class="energyBarChart-legend"> -->
          <!-- <li><span style="background-color:rgba(4,72,95,1)"></span>Energy Consumed (MW)</li> -->
          <!-- <li><span style="background-color:rgba(10,168,223,1)"></span>Energy Harvested (MW)</li> -->
        <!-- </ul> -->
      </div>
      <div id="circuitSection" class="section even">
        <img class="icon" src="images/lightblue_lightbulb.jpg"/>
        <!-- <canvas id="energyUsedPieChart" width="200" height="150" ></canvas> -->
        <!-- <canvas id="energyGainedPieChart" width="200" height="150"></canvas> -->
        <h2>Circuit-level graphs coming soon...</h2>
      </div>
      <div class="section odd">
        <h2>Water flow graphs coming soon...</h2>
      </div>
      <div class="section even">
        <h2>Temperature graphs coming soon...</h2>
      </div>
      <div id="ball">
        data powered by Ball Systems
      </div>
    </div>
    <div id="mainNav" class="clearfix" style="z-index:2000;">
      <a href="index.html"><img src="images/grayhouse.png" id="homelogo"></a>
      <div id="horizontalMenu" >
        <a href="data.html" id="dataButton" class="animatedButton"></a>
        <!-- <a href="" id="tourButton" class="animatedButton"></a> -->
        <a href="partners.html" id="partnerButton" class="animatedButton"></a>
        <a href="about.html" id="aboutButton" class="animatedButton"></a>
      </div>
      <img src="images/houselogo_small.png" id="hamburgerIcon" />
    </div>
</body>
</html>